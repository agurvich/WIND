COMMONFILES=common/common_gold.c
LINEARALGEBRAFILES=$(wildcard linear_algebra/*.c)

ODEFILE=../ode_system/ode_gold.c
RK2FILE=rk2/rk2_gold.c
SIEFILE=sie/sie_gold.c

RK2EXECUTABLE=rk2_gold.so
SIEEXECUTABLE=sie_gold.so


CONFIG= -DADAPTIVE_TIMESTEP #-DDEBUGBLOCK=0 #-DLOUD
CONFIG+= -DABSOLUTE_TOLERANCE=5e-3
CONFIG+= -DRELATIVE_TOLERANCE=5e-3

COMMONOBJS=$(COMMONFILES:%.c=%.o)
ODEOBJS=$(ODEFILE:%.c=%.o)
LINEARALGEBRAOBJS=$(LINEARALGEBRAFILES:%.c=%.o)

INCLUDE= -Ilinear_algebra -I. -I../ode_system -Iinclude -Icommon

CFLAGS=-shared -fPIC -g -std=c99

make: $(COMMONOBJS) $(ODEOBJS) $(LINEARALGEBRAOBJS)
	gcc $(CFLAGS) $(CONFIG) $(INCLUDE) -o $(RK2EXECUTABLE) $(COMMONOBJS) $(ODEOBJS) $(RK2FILE)
	gcc $(CFLAGS) $(CONFIG) $(INCLUDE) -o $(SIEEXECUTABLE) $(COMMONOBJS) $(ODEOBJS) $(LINEARALGEBRAOBJS) $(SIEFILE)
%.o: %.c
	gcc $(CFLAGS) $(CONFIG) $(INCLUDE) -o $@ -c $<
clean:
	rm $(COMMONOBJS) $(ODEOBJS) $(LINEARALGEBRAOBJS) $(RK2EXECUTABLE) $(SIEEXECUTABLE)
