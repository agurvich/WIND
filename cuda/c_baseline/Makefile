COMMONFILES=common/common_gold.c
LINEARALGEBRAFILES=$(wildcard linear_algebra/*.c)

GOLDODEFILE=../ode_system/ode_gold.c
RK2FILE=rk2/rk2_gold.c
SIEFILE=sie/sie_gold.c

RK2EXECUTABLE=../lib/rk2_gold.so
SIEEXECUTABLE=../lib/sie_gold.so


WINDCONFIG= -DADAPTIVE_TIMESTEP #-DDEBUGBLOCK=0 #-DLOUD
WINDCONFIG+= -DABSOLUTE_TOLERANCE=5e-3
WINDCONFIG+= -DRELATIVE_TOLERANCE=5e-3

COMMONOBJS=$(COMMONFILES:%.c=%.o)
GOLDGOLDODEOBJS=$(GOLDODEFILE:%.c=%.o)
LINEARALGEBRAOBJS=$(LINEARALGEBRAFILES:%.c=%.o)

INCLUDE= -Ilinear_algebra -I. -I../ode_system -Iinclude -Icommon -I../include

CFLAGS=-shared -fPIC -g -std=c99

make: $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS)
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $(RK2EXECUTABLE) $(COMMONOBJS) $(GOLDODEOBJS) $(RK2FILE)
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $(SIEEXECUTABLE) $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS) $(SIEFILE)
%.o: %.c
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $@ -c $<
preclean:
	rm ../ode_system/precompile_ode_gold.o
clean:
	rm $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS) $(RK2EXECUTABLE) $(SIEEXECUTABLE)
