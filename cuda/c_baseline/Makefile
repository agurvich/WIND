ABSOLUTE=5e-3
RELATIVE=5e-3

COMMONFILES=common/common_gold.c
LINEARALGEBRAFILES=$(wildcard linear_algebra/*.c)

GOLDODEFILE=../ode_system/ode_gold.c
RK2FILE=rk2/rk2_gold.c
SIEFILE=sie/sie_gold.c

RK2EXECUTABLE=../lib/rk2_gold.so
SIEEXECUTABLE=../lib/sie_gold.so


WINDCONFIG= -DADAPTIVE_TIMESTEP #-DDEBUGBLOCK=0 #-DLOUD
WINDCONFIG+= -DABSOLUTE_TOLERANCE=$(ABSOLUTE)
WINDCONFIG+= -DRELATIVE_TOLERANCE=$(RELATIVE)

COMMONOBJS=$(COMMONFILES:%.c=%.o)
GOLDODEOBJS=$(GOLDODEFILE:%.c=%.o)
LINEARALGEBRAOBJS=$(LINEARALGEBRAFILES:%.c=%.o)

INCLUDE= -Ilinear_algebra -I. -I../ode_system -Iinclude -Icommon -I../include

CFLAGS=-shared -fPIC -std=c99 -O3 #-g #

make: $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS)
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $(RK2EXECUTABLE) $(COMMONOBJS) $(GOLDODEOBJS) $(RK2FILE)
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $(SIEEXECUTABLE) $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS) $(SIEFILE)
%.o: %.c
	gcc $(CFLAGS) $(WINDCONFIG) $(INCLUDE) -o $@ -c $<
preclean:
	rm ../ode_system/precompile_ode_gold.o
clean:
	rm $(COMMONOBJS) $(GOLDODEOBJS) $(LINEARALGEBRAOBJS) $(RK2EXECUTABLE) $(SIEEXECUTABLE)
